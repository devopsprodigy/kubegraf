/*! For license information please see module.js.LICENSE.txt */
define(["app/core/app_events","@grafana/data","app/core/utils/kbn","@grafana/runtime"],(function(t,e,r,n){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=12)}([function(t,e,r){"use strict";r.d(e,"d",(function(){return n})),r.d(e,"k",(function(){return o})),r.d(e,"h",(function(){return s})),r.d(e,"g",(function(){return a})),r.d(e,"f",(function(){return i})),r.d(e,"c",(function(){return u})),r.d(e,"b",(function(){return c})),r.d(e,"a",(function(){return p})),r.d(e,"e",(function(){return d})),r.d(e,"j",(function(){return l})),r.d(e,"i",(function(){return f}));var n=3,o=2,s=1,a=0,i=4,u="#ffff0096",c="#a52a2a",p="#299c46",d=10,l="prometheus",f="devopsprodidy-kubegraf-datasource"},function(t,e,r){"use strict";r.d(e,"b",(function(){return o})),r.d(e,"a",(function(){return s})),r.d(e,"c",(function(){return a})),r.d(e,"e",(function(){return i})),r.d(e,"d",(function(){return c}));var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function o(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function s(t,e,r,n){return new(r||(r=Promise))((function(o,s){function a(t){try{u(n.next(t))}catch(t){s(t)}}function i(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,i)}u((n=n.apply(t,e||[])).next())}))}function a(t,e){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function i(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,o,s=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(t){o={error:t}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(o)throw o.error}}return a}function c(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(u(arguments[e]));return t}},function(e,r){e.exports=t},,,function(t,r){t.exports=e},function(t,e){t.exports=r},function(t,e){t.exports=n},,,,,function(t,e,r){"use strict";r.r(e);var n=r(7),o=r(1),s=new(function(){function t(){}return t.prototype.get=function(t){return window.localStorage[t]},t.prototype.set=function(t,e){window.localStorage[t]=e},t.prototype.getBool=function(t,e){return void 0===e||this.exists(t)?"true"===window.localStorage[t]:e},t.prototype.getObject=function(t,e){var r=e;if(this.exists(t)){var n=window.localStorage[t];try{r=JSON.parse(n)}catch(t){}}return r},t.prototype.setObject=function(t,e){var r;try{r=JSON.stringify(e)}catch(t){return!1}try{this.set(t,r)}catch(t){return!1}return!0},t.prototype.exists=function(t){return void 0!==window.localStorage[t]},t.prototype.delete=function(t){window.localStorage.removeItem(t)},t}()),a=r(2),i=r.n(a),u=r(0),c=function(){function t(t){this.name=t.metadata.name,this.data=t,this.is_deleted=!1,this.open=!0,this.limit=u.e}return t.prototype.update=function(t){this.name=t.metadata.name,this.data=t},t.prototype.destroy=function(){this.is_deleted=!0},t.prototype.toggle=function(){this.open=!this.open},t.prototype.showAllPods=function(){this.limit=!1},t}(),p=function(t){function e(e){var r=t.call(this,e)||this;return r.eventMessage=null,r.metrics={cpuUsed:"N-A",memoryUsed:"N-A",cpuRequested:"N-A",memoryRequested:"N-A",cpuLimit:"N-A",memoryLimit:"N-A"},r.sourceMetrics={cpuUsed:null,memoryUsed:null,cpuRequested:null,memoryRequested:null,cpuLimit:null,memoryLimit:null},r.used=!1,r}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"status",{get:function(){if(this.data.metadata.deletionTimestamp)return u.h;if("Running"===this.data.status.phase){var t=void 0,e=void 0,r=void 0;return this.data.status.conditions&&(t=(t=this.data.status.conditions.filter((function(t){return"False"===t.status}))).length>0),this.data.status.containerStatuses&&(e=(e=this.data.status.containerStatuses.filter((function(t){return!1===t.ready}))).length>0),this.data.status.initContainerStatuses&&(r=(r=this.data.status.initContainerStatuses.filter((function(t){return!1===t.ready}))).length>0),t||e||r?u.d:u.g}switch(this.data.status.phase){case"Pending":return u.k;case"Succeeded":return u.f;case"Failed":case"Unknown":default:return u.d}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){switch(this.status){case u.d:return"error";case u.k:return"warning";case u.h:return"terminating";case u.g:return"success";case u.f:return"succeeded";default:return"success"}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){if(this.eventMessage)return this.eventMessage;var t=this.status,e=this.data,r=this.data.status.phase,n="Pod is "+r;if(t===u.d){if(e.status.containerStatuses){if((o=e.status.containerStatuses.filter((function(t){return!1===t.ready}))[0])&&o.state&&o.state.waiting&&o.state.waiting.message&&o.state.waiting.reason)return n=o.state.waiting.reason+". "+o.state.waiting.message}else if(e.status.conditions){if(void 0!==(o=e.status.conditions.filter((function(t){return!1===t.ready||"PodScheduled"===t.type&&"False"===t.status}))[0]))return o.message}else if(e.status.message)return e.status.message;return"Undefined error"}if(this.data.metadata.deletionTimestamp)return"Pod is Terminating";if("Running"===r||"Succeeded"===r)return"Pod is "+r;if(e.status.containerStatuses)(o=e.status.containerStatuses.filter((function(t){return!1===t.ready}))[0]).state.waiting.message&&o.state.waiting.message.length>0&&(n=o.state.waiting.message);else if(e.status.conditions){var o;void 0!==(o=e.status.conditions.filter((function(t){return!1===t.ready||"PodScheduled"===t.type&&"False"===t.status}))[0])&&(n=o.message)}else e.status.message&&(n=e.status.message);return n},set:function(t){this.eventMessage=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"NaMessage",{get:function(){return"Prometheus metrics unavailable"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usageCpuColor",{get:function(){if(null===this.sourceMetrics.cpuUsed)return"";if(this.sourceMetrics.cpuRequested&&this.sourceMetrics.cpuLimit){var t=.5*(this.sourceMetrics.cpuLimit-this.sourceMetrics.cpuRequested)+this.sourceMetrics.cpuRequested,e=.8*(this.sourceMetrics.cpuLimit-this.sourceMetrics.cpuRequested)+this.sourceMetrics.cpuRequested;return this.sourceMetrics.cpuUsed<t?"green":this.sourceMetrics.cpuUsed>=e?"red":"yellow"}return"red"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"usageMemoryColor",{get:function(){if(null===this.sourceMetrics.memoryUsed)return"";if(this.sourceMetrics.memoryRequested&&this.sourceMetrics.memoryLimit){var t=.5*(this.sourceMetrics.memoryLimit-this.sourceMetrics.memoryRequested)+this.sourceMetrics.memoryRequested,e=.8*(this.sourceMetrics.memoryLimit-this.sourceMetrics.memoryRequested)+this.sourceMetrics.memoryRequested;return this.sourceMetrics.memoryUsed<t?"green":this.sourceMetrics.memoryUsed>=e?"red":"yellow"}return"red"},enumerable:!1,configurable:!0}),e}(c),d=r(5),l=function(){function t(t){this.__getLastNonNullValue=function(t){if(!t.fields){if(t.datapoints){var e=t.datapoints.filter((function(t){return null!=t[0]}));return e[e.length-1][0]}return 0}var r=t.fields.filter((function(t){return t.name&&"Value"===t.name}));if(r){var n=r[0].values.buffer.filter((function(t){return null!=t})),o=n[n.length-1];return o}},this.__getName=function(t,e){return void 0!==t.target?t.target.substring(e.legend.length+3,t.target.length-2):void 0!==t.name?t.name.substring(e.legend.length+3,t.name.length-2):void 0},this.ds=t}return t.prototype.query=function(t,e){var r=this;void 0===e&&(e=!1);var n={range:{from:Object(d.dateTime)().subtract(2,"minute"),to:Object(d.dateTime)()},targets:[{expr:t.expr,format:"time_series"}],legendFormat:"{{"+t.legend+"}}",interval:"15s"},o=this.ds.query(n);return"function"!=typeof o.then&&(o=o.toPromise()),o.then((function(n){return n&&n.data?r.formData(n.data,t,e):{}}))},t.prototype.formData=function(t,e,r){var n=this;return void 0===r&&(r=!1),t.map((function(t){return{target:n.__getName(t,e),datapoint:n.__getLastNonNullValue(t)}}))},t}(),f=function(t){function e(e){return t.call(this,e)||this}return Object(o.b)(e,t),Object.defineProperty(e.prototype,"status",{get:function(){var t=this.data.conditions.filter((function(t){return"Healthy"===t.type}))[0];return void 0!==t&&"True"===t.status?u.g:u.d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){switch(this.status){case u.g:return u.a;case u.d:return u.b;default:return}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){var t=this.data.conditions;if(t){var e=t.filter((function(t){return"Healthy"===t.type}))[0];return e&&e.message}},enumerable:!1,configurable:!0}),e}(c),h=function(t){function e(e){return t.call(this,e)||this}return Object(o.b)(e,t),e}(c),m=function(t){function e(e){var r=t.call(this,e)||this;return r.pods=[],r}return Object(o.b)(e,t),e}(c),y=function(t){function e(e){var r=t.call(this,e)||this;return r.jobs=[],r}return Object(o.b)(e,t),e}(c),g=function(t){function e(e){var r=t.call(this,e)||this;return r.deployments=[],r.statefulsets=[],r.daemonsets=[],r.other=[{pods:[]}],r.sort="name",r}return Object(o.b)(e,t),e.prototype.toggle=function(){var e=this;t.prototype.toggle.call(this);var r=s.getObject("namespaceStore"),n=r.findIndex((function(t){return t.name===e.name}));(n||0===n)&&(r[n].open=this.open),s.setObject("namespaceStore",r)},e}(c),b=function(t){function e(e){var r=t.call(this,e)||this;return r.pods=[],r.services=[],r}return Object(o.b)(e,t),e}(c),v=function(t){function e(e){var r=t.call(this,e)||this;return r.pods=[],r}return Object(o.b)(e,t),e}(c),_=function(t){function e(e){var r=t.call(this,e)||this;return r.pods=[],r}return Object(o.b)(e,t),e}(c),S=r(6),P=r.n(S),M=function(t){return P.a.valueFormats.bytes(t,3,null)},w=function(t){return parseFloat(t).toFixed(3)},O=function(t){return 1e3*t+"m"},q=function(t,e){return(parseFloat(t)/parseFloat(e)*100).toFixed(2)+"%"},C=function(t){var e=5;try{e=t.grafanaBootData.settings.buildInfo.version.split(".")[0]}catch(t){}return e},j=function(t){function e(e){var r=t.call(this,e)||this;return r.namespaces=[],r.metrics={cpuUsed:"N/A",memoryUsed:"N/A",podsCount:"N/A",cpuRequested:"N/A",memoryRequested:"N/A",cpuLimit:"N/A",memoryLimit:"N/A"},r.cpuIndicate=!1,r.memoryIndicate=!1,r.podsIndicate=!1,r.cpuRequestedIndicate=!1,r.memoryRequestedIndicate=!1,r.podsRequestedIndicate=!1,r.cpuLimitIndicate=!1,r.memoryLimitIndicate=!1,r.nsListState(),r.hideNs=s.getBool(r.name+"NsList",!1),r}return Object(o.b)(e,t),e.prototype.toggle=function(){var e=this;t.prototype.toggle.call(this);var r=s.getObject("nodeStore"),n=r.findIndex((function(t){return t.name===e.name}));(n||0===n)&&(r[n].open=this.open),s.setObject("nodeStore",r)},e.prototype.nsListState=function(){return void 0===s.get(this.name+"NsList")&&s.set(this.name+"NsList",!0),s.get(this.name+"NsList")},Object.defineProperty(e.prototype,"status",{get:function(){var t=this.data.status.conditions.filter((function(t){return"Ready"===t.type}))[0];return void 0!==t&&"True"===t.status?u.g:u.d},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsCount",{get:function(){return this.namespaces?this.namespaces.reduce((function(t,e){return t+e.pods.length}),0):0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.status===u.g?"#18e018":u.b},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this.status===u.g?"ok":"Node isn't ready"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuStatus",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),this.__getStatus(this.metrics.cpuUsed,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuStatusRequested",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),this.__getStatusRequested(this.metrics.cpuRequested,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuLimitStatus",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),this.__getStatusLimit(this.metrics.cpuLimit,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryStatus",{get:function(){return this.__getStatus(this.metrics.memoryUsed,this.__getBytes(this.data.status.allocatable.memory))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryStatusRequested",{get:function(){return this.__getStatusRequested(this.metrics.memoryRequested,this.__getBytes(this.data.status.allocatable.memory))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryLimitStatus",{get:function(){return this.__getStatusLimit(this.metrics.memoryLimit,this.__getBytes(this.data.status.allocatable.memory))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsStatus",{get:function(){return this.__getStatus(this.metrics.podsCount,this.data.status.allocatable.pods)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsStatusRequested",{get:function(){return this.__getStatusRequested(this.metrics.podsCount,this.data.status.allocatable.pods)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hostIp",{get:function(){return this.data.status.addresses.filter((function(t){return"InternalIP"===t.type}))[0].address},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryCapacityFormatted",{get:function(){return M(this.__getBytes(this.data.status.capacity.memory))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryAllocatableFormatted",{get:function(){return M(this.__getBytes(this.data.status.allocatable.memory))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuAllocatableFormatted",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryUsedFormatted",{get:function(){return M(this.metrics.memoryUsed)+" ("+q(this.metrics.memoryUsed,this.__getBytes(this.data.status.allocatable.memory))+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryRequestedFormatted",{get:function(){return M(this.metrics.memoryRequested)+" ("+q(this.metrics.memoryRequested,this.__getBytes(this.data.status.allocatable.memory))+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryLimitFormatted",{get:function(){return M(this.metrics.memoryLimit)+" ("+q(this.metrics.memoryLimit,this.__getBytes(this.data.status.allocatable.memory))+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuUsedFormatted",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),w(this.metrics.cpuUsed)+" ("+q(this.metrics.cpuUsed,t)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuRequestedFormatted",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),w(this.metrics.cpuRequested)+" ("+q(this.metrics.cpuRequested,t)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuLimitFormatted",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),w(this.metrics.cpuLimit)+" ("+q(this.metrics.cpuLimit,t)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsUsedFormatted",{get:function(){return this.metrics.podsCount+" ("+q(this.metrics.podsCount,this.data.status.allocatable.pods)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsRequestedFormatted",{get:function(){return this.metrics.podsCount+" ("+q(this.metrics.podsCount,this.data.status.allocatable.pods)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuPercentUsed",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),w(this.metrics.cpuUsed)+" / "+t+" ("+q(this.metrics.cpuUsed,t)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cpuPercentRequested",{get:function(){var t=this.data.status.allocatable.cpu;return t.indexOf("m")>-1&&(t=parseInt(t,10)/1e3),w(this.metrics.cpuRequested)+" / "+t+" ("+q(this.metrics.cpuRequested,t)+")"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryPercentUsed",{get:function(){var t=this.metrics.memoryUsed,e=this.__getBytes(this.data.status.allocatable.memory),r=q(t,e);return M(t)+" / "+M(e)+" ("+r+") "},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"memoryPercentRequested",{get:function(){var t=this.__getBytes(this.data.status.allocatable.memory),e=q(this.metrics.memoryRequested,t);return M(this.metrics.memoryRequested)+" / "+M(t)+" ("+e+") "},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"podsPercentUsed",{get:function(){var t=this.metrics.podsCount,e=this.data.status.allocatable.pods;return t+" / "+e+" ("+q(t,e)+") "},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowCpuColor",{get:function(){return this.__getColor(this.cpuStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowCpuRequestedColor",{get:function(){return this.__getColor(this.cpuStatusRequested)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowCpuLimitColor",{get:function(){return this.__getColor(this.cpuLimitStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowMemoryColor",{get:function(){return this.__getColor(this.memoryStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowMemoryRequestedColor",{get:function(){return this.__getColor(this.memoryStatusRequested)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowMemoryLimitColor",{get:function(){return this.__getColor(this.memoryLimitStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowPodsColor",{get:function(){return this.__getColor(this.podsStatus)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowPodsRequestedColor",{get:function(){return this.__getColor(this.podsStatusRequested)},enumerable:!1,configurable:!0}),e.prototype.parseMetrics=function(t,e,r,n,o,s,a){var i={podsStatus:this.podsStatus,podsStatusRequested:this.podsStatusRequested,cpuStatus:this.cpuStatus,cpuStatusRequested:this.cpuStatusRequested,cpuLimitStatus:this.cpuLimitStatus,memoryStatus:this.memoryStatus,memoryStatusRequested:this.memoryStatusRequested,memoryLimitStatus:this.memoryLimitStatus};for(var u in this.metrics.cpuRequested=this.__getLastMetric(t),this.metrics.memoryRequested=this.__getLastMetric(e),this.metrics.podsCount=this.__getLastMetricByInstance(r),this.metrics.cpuUsed=this.__getLastMetricByInstance(n),this.metrics.memoryUsed=this.__getLastMetricByInstance(o),this.metrics.cpuLimit=this.__getLastMetricByInstance(s),this.metrics.memoryLimit=this.__getLastMetricByInstance(a),i)i.hasOwnProperty(u)&&this.hasOwnProperty(u)&&void 0!==i[u]&&i[u]!==this[u]&&this.setMetricIndicated(u)},e.prototype.setMetricIndicated=function(t){var e=this,r={podsStatus:"podsIndicate",podsStatusRequested:"podsRequestedIndicate",cpuStatus:"cpuIndicate",cpuStatusRequested:"cpuRequestedIndicate",cpuLimitStatus:"cpuLimitIndicate",memoryStatus:"memoryIndicate",memoryStatusRequested:"memoryRequestedIndicate",memoryLimitStatus:"memoryLimitIndicate"};r[t]&&this.hasOwnProperty(r[t])&&(this[r[t]]=!0,setTimeout((function(){e[r[t]]=!1}),1e4))},e.prototype.__getLastMetricByInstance=function(t){var e=this,r=t.filter((function(t){return t.target.includes(e.hostIp)||t.target.includes(e.name)}))[0];return void 0!==r?r.datapoint:"N/A"},e.prototype.__getLastMetric=function(t){var e=this,r=t.filter((function(t){return t.target===e.name}))[0];return void 0!==r?r.datapoint:"N/A"},e.prototype.__getBytes=function(t){var e=1024*this.__parseInt(t);return t.indexOf("Mi")>-1&&(e*=1024),e},e.prototype.__parseInt=function(t){return parseInt(t,10)},e.prototype.__getStatus=function(t,e){var r=t/e;return r<=.5?u.g:r>.5&&r<=.8?u.k:r>.8?u.d:void 0},e.prototype.__getStatusRequested=function(t,e){var r=t/e;return r<=.5?u.g:r>.5&&r<=.8?u.k:r>.8?u.d:void 0},e.prototype.__getStatusLimit=function(t,e){var r=t/e;return r<=.9?u.g:r>.9&&r<=1?u.k:r>1?u.d:void 0},e.prototype.__getColor=function(t){switch(t){case u.g:return u.a;case u.k:return u.c;case u.d:return u.b;default:return}},e}(c),R=function(){function t(t,e,r,n,o,s,a,u){this.nodesMapReady=!1,this.storePods=[],this.storeEvents=null,this.storeComponents=[],this.storeServices=[],this.storeJobs=[],this.storeCronJobs=[],this.storeDeployments=[],this.storeStatefulSets=[],this.storeDaemonSets=[],this.namespaceMap=[],this.nodesMap=[],this.nodesError=!1,this.podsError=!1,this.componentsError=!1,this.orgId=1,this.showMenu=!1,this.$q=a,this.$scope=t,this.pageReady=!1,this.location=o,this.backendSrv=e,this.contextSrv=n,this.datasourceSrv=r,this.timeout=s,this.orgId=u.grafanaBootData&&u.grafanaBootData.user?u.grafanaBootData.user.orgId:1;try{this.isAdmin=this.contextSrv.hasRole("Admin")}catch(t){this.isAdmin=!1}if("clusterName"in o.search()){document.title="DevOpsProdigy KubeGraf";var c=document.querySelector(".scroll-canvas");this.scrollToTop=function(){c.scrollTo({top:0,left:c.scrollLeft,behavior:"smooth"})}}else i.a.emit("alert-error",["Cluster not specified"])}return t.prototype.updatePods=function(t){},t.prototype.__getServersInfo=function(t){return Object(o.a)(this,void 0,void 0,(function(){var e,r,n,s,a,i,u,c,p;return Object(o.c)(this,(function(d){switch(d.label){case 0:return e=[],r=t.reduce((function(t,e){return Object(o.d)(t,[e.name+"|"+e.hostIp+":.+"])}),[]).join("|"),[4,Promise.all([this.prometheusDS.query({expr:'count(count(node_cpu_seconds_total{instance=~"'+r+'"}) by (cpu, instance)) by (instance)',legend:"instance"},!1),this.prometheusDS.query({expr:'sum(node_memory_MemTotal_bytes{instance=~"'+r+'"}) by (instance)',legend:"instance"},!1),this.prometheusDS.query({expr:'sum(node_memory_SwapTotal_bytes{instance=~"'+r+'"}) by (instance)',legend:"instance"},!1),this.prometheusDS.query({expr:'sum(node_filesystem_size_bytes{instance=~"'+r+'",mountpoint="/",fstype!="rootfs"}) by (instance)',legend:"instance"},!1),this.prometheusDS.query({expr:'sum(node_load1{instance=~"'+r+'"}) by (instance)',legend:"instance"},!1),this.prometheusDS.query({expr:'sum(node_time_seconds{instance=~"'+r+'"} - node_boot_time_seconds{instance=~"'+r+'"}) by (instance)',legend:"instance"},!1)])];case 1:n=d.sent(),s=function(t){var r,o=n.map((function(e){return e.find((function(e){return e.target===t.name||0===e.target.indexOf(t.hostIp+":")}))}));e[t.name]={cpuCores:o[0]&&o[0].datapoint,ramTotal:o[1]&&M(o[1].datapoint),swapTotal:o[2]&&M(o[2].datapoint),rootFSTotal:o[3]&&M(o[3].datapoint),sysLoad:o[4]&&o[4].datapoint,uptime:o[5]&&(r=1e3*o[5].datapoint,P.a.valueFormats.ms(r,1,null))}};try{for(a=Object(o.e)(t),i=a.next();!i.done;i=a.next())u=i.value,s(u)}catch(t){c={error:t}}finally{try{i&&!i.done&&(p=a.return)&&p.call(a)}finally{if(c)throw c.error}}return[2,e]}}))}))},t.prototype.getNodeDashboardLink=function(t){var e="dashboard/db/devopsprodigy-kubegraf-nodes-dashboard?orgId="+this.orgId;return e+="&var-cluster="+this.cluster.name,e+="&var-node="+t.name},t.prototype.getPodDashboardLink=function(t){var e="dashboard/db/devopsprodigy-kubegraf-pods-dashboard?orgId="+this.orgId;return e+="&var-cluster="+this.cluster.name,e+="&var-namespace="+t.data.metadata.namespace,e+="&var-pod="+t.name},t.prototype.getEntityDashboardLink=function(t,e){var r=e.substring(0,e.length-1),n="dashboard/db/devopsprodigy-kubegraf-"+e+"-dashboard?orgId="+this.orgId;return n+="&var-cluster="+this.cluster.name,n+="&var-namespace="+t.data.metadata.namespace,n+="&var-"+r+"="+t.name},t.prototype.getNodeMap=function(t){var e=this;void 0===t&&(t=!1);var r=[];return r.push(this.getNodes()),t||r.push(this.getPods(!0)),this.$q.all(r).then((function(){t||(e.insertPodsToNodesMap(e.storePods),e.getPodsMetrics()),e.timeout((function(){e.refreshNodes()}),e.refreshRate)}))},t.prototype.getResourcesMetrics=function(){var t=this,e=[];return e.push(this.__getCpuMetricsRequested()),e.push(this.__getMemoryMetricsRequested()),e.push(this.__getPodsCountMetrics()),e.push(this.__getCpuMetricsUsed()),e.push(this.__getMemoryMetricsUsed()),e.push(this.__getCpuLimitMetrics()),e.push(this.__getMemoryLimitMetrics()),this.$q.all(e).then((function(e){t.nodesMap.forEach((function(t){t.parseMetrics(e[0],e[1],e[2],e[3],e[4],e[5],e[6])})),t.timeout((function(){t.getResourcesMetrics()}),t.refreshRate)}))},t.prototype.__getCpuMetricsUsed=function(){return this.prometheusDS.query({expr:'sum(rate(container_cpu_usage_seconds_total{id="/"}[2m])) by (instance)',legend:"instance"},!1).then((function(t){return t}))},t.prototype.__getCpuMetricsRequested=function(){return this.prometheusDS.query({expr:'sum(sum(kube_pod_container_resource_requests{resource="cpu",unit="core"}) by (namespace, pod, node) * on (pod, namespace) group_left()  (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1)) by (node)',legend:"node"},!1).then((function(t){return t}))},t.prototype.__getCpuLimitMetrics=function(){return this.prometheusDS.query({expr:'sum(sum(kube_pod_container_resource_limits{resource="cpu", unit="core"}) by (namespace, pod, node) * on (pod, namespace) group_left()  (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1)) by (node)',legend:"node"},!1).then((function(t){return t}))},t.prototype.__getMemoryMetricsRequested=function(){return this.prometheusDS.query({expr:'sum(sum(kube_pod_container_resource_requests{resource="memory", unit="byte"}) by (namespace, pod, node) * on (pod, namespace) group_left() (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1)) by (node)',legend:"node"},!1).then((function(t){return t}))},t.prototype.__getMemoryLimitMetrics=function(){return this.prometheusDS.query({expr:'sum(sum(kube_pod_container_resource_limits{resource="memory", unit="byte"}) by (namespace, pod, node) * on (pod, namespace) group_left()  (sum(kube_pod_status_phase{phase="Running"}) by (pod, namespace) == 1)) by (node)',legend:"node"},!1).then((function(t){return t}))},t.prototype.__getMemoryMetricsUsed=function(){return this.prometheusDS.query({expr:"sum(node_memory_MemTotal_bytes) by (instance) - sum(node_memory_MemFree_bytes) by (instance) - sum(node_memory_Buffers_bytes) by (instance) - sum(node_memory_Cached_bytes) by (instance) ",legend:"instance"},!1).then((function(t){return t}))},t.prototype.__getPodsCountMetrics=function(){return this.prometheusDS.query({expr:"sum(kubelet_running_pod_count) by (instance)",legend:"instance"},!1).then((function(t){return t}))},t.prototype.getNodes=function(){var t=this;return this.cluster.getNodes().then((function(e){var r=[],n=s.getObject("nodeStore");n&&(r=n),e instanceof Array?(t.nodesError=!1,e.forEach((function(e){var n=new j(e);t.nodesMap.push(n);var o=r.findIndex((function(t){return t.name===n.name}));o>-1?n.open=r[o].open:r.push({name:n.name,open:n.open})})),s.setObject("nodeStore",r)):e instanceof Error&&(t.nodesError=e)}))},t.prototype.getPodsMetrics=function(){var t=this,e=[];e.push(this.__getPodsUsedCpu()),e.push(this.__getPodsUsedMemory()),e.push(this.__getPodsRequestedCpu()),e.push(this.__getPodsRequestedMemory()),e.push(this.__getPodsLimitCpu()),e.push(this.__getPodsLimitMemory()),this.$q.all(e).then((function(e){t.nodesMap.forEach((function(t){t.namespaces.map((function(t){t.pods.map((function(t){var r=e[0].find((function(e){return e.target===t.name})),n=e[1].find((function(e){return e.target===t.name})),o=e[2].find((function(e){return e.target===t.name})),s=e[3].find((function(e){return e.target===t.name})),a=e[4].find((function(e){return e.target===t.name})),i=e[5].find((function(e){return e.target===t.name}));void 0!==r&&(t.sourceMetrics.cpuUsed=r.datapoint,t.metrics.cpuUsed=O(r.datapoint.toFixed(3))),void 0!==n&&(t.sourceMetrics.memoryUsed=n.datapoint,t.metrics.memoryUsed=M(n.datapoint)),void 0!==o&&(t.sourceMetrics.cpuRequested=o.datapoint,t.metrics.cpuRequested=O(w(o.datapoint))),void 0!==s&&(t.sourceMetrics.memoryRequested=s.datapoint,t.metrics.memoryRequested=M(s.datapoint)),void 0!==a&&(t.sourceMetrics.cpuLimit=a.datapoint,t.metrics.cpuLimit=O(w(a.datapoint))),void 0!==i&&(t.sourceMetrics.memoryLimit=i.datapoint,t.metrics.memoryLimit=M(i.datapoint))}))}))})),t.timeout((function(){t.getPodsMetrics()}),t.refreshRate)}))},t.prototype.__getPodsUsedCpu=function(){return this.prometheusDS.query({expr:'sum(rate(container_cpu_usage_seconds_total{pod!="", container!="", container!="POD"}[2m])) by (pod) or sum(label_replace(rate(container_cpu_usage_seconds_total{pod_name!="", container_name!="", container_name!="POD"}[2m]), "pod", "$1", "pod_name", "(.*)")) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.__getPodsUsedMemory=function(){return this.prometheusDS.query({expr:'sum(container_memory_working_set_bytes{container!="", container!="POD"}) by (pod) or sum(label_replace(container_memory_working_set_bytes{container_name!="", container_name!="POD"}, "pod", "$1", "pod_name", "(.*)")) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.__getPodsRequestedCpu=function(){return this.prometheusDS.query({expr:'sum(kube_pod_container_resource_requests{resource="cpu",unit="core"}) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.__getPodsLimitCpu=function(){return this.prometheusDS.query({expr:'sum(kube_pod_container_resource_limits{resource="cpu", unit="core"}) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.__getPodsRequestedMemory=function(){return this.prometheusDS.query({expr:'sum(kube_pod_container_resource_requests{resource="memory", unit="byte"}) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.__getPodsLimitMemory=function(){return this.prometheusDS.query({expr:'sum(kube_pod_container_resource_limits{resource="memory", unit="byte"}) by (pod)',legend:"pod"},!1).then((function(t){return t}))},t.prototype.insertPodsToNodesMap=function(t){this.nodesMap.forEach((function(e){t.filter((function(t){return t.data.status.hostIP===e.hostIp})).forEach((function(t){if(0===e.namespaces.filter((function(e){return e.name===t.data.metadata.namespace})).length){var r={name:t.data.metadata.namespace,pods:[],limit:u.e,sort:"name"};e.namespaces.push(r)}e.namespaces.filter((function(e){return e.name===t.data.metadata.namespace}))[0].pods.push(t)}))}))},t.prototype.refreshNodes=function(){var t=this;this.cluster.getNodes().then((function(e){return t.nodesMap.forEach((function(t){var r=e.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));r.length>0&&(r=r[0],t.update(r))}))})).then((function(){t.timeout((function(){t.refreshNodes()}),t.refreshRate)}))},t.prototype.getNamespaceMap=function(){var t=this;this.cluster.getNamespaces().then((function(e){var r=[],n=s.getObject("namespaceStore");n&&(r=n),e.forEach((function(e){var n=new g(e);t.namespaceMap.push(n);var o=r.findIndex((function(t){return t.name===n.name}));o>-1?n.open=r[o].open:r.push({name:n.name,open:n.open})})),s.setObject("namespaceStore",r);var o=[];o.push(t.attachDeployments()),o.push(t.attachStatefulsets()),o.push(t.attachDaemonsets()),o.push(t.getClusterCronJobs()),o.push(t.getClusterJobs()),t.$q.all(o).then((function(){t.attachJobs(),t.attachCronJobs();var e=[];e.push(t.getAllServices()),e.push(t.getPods()),t.$q.all(e).then((function(){t.attachPodsToMap(),t.namespaceMapReady=!0}))}))}))},t.prototype.refreshNamespaceMap=function(){var t=this;this.cluster.getNamespaces().then((function(e){var r=[];e.forEach((function(e){var n=new g(e);if(t.namespaceMap.every((function(t){return t.name!==n.name}))){t.namespaceMap.push(n);var o=r.findIndex((function(t){return t.name===n.name}));o>-1?n.open=r[o].open:r.push({name:n.name,open:n.open})}})),t.namespaceMap.forEach((function(n,o){if(e.every((function(t){return t.metadata.name!==n.name}))){t.namespaceMap.splice(o,1);var s=r.findIndex((function(t){return t.name===n.name}));s>-1&&r.splice(s,1)}})),s.setObject("namespaceStore",r);var n=[];n.push(t.refreshDeployments()),n.push(t.refreshStatefulsets()),n.push(t.refreshDaemonsets()),n.push(t.getClusterCronJobs()),n.push(t.refreshJobs()),t.$q.all(n).then((function(){var e=[];e.push(t.getAllServices()),t.$q.all(e).then((function(){t.attachPodsToMap(),t.namespaceMapReady=!0}))}))}))},t.prototype.attachDeployments=function(){var t=this;return this.cluster.getDeployments().then((function(e){e.forEach((function(e){var r=new b(e),n=t.__getNamespace(e.metadata.namespace);t.storeDeployments.push(r),n.deployments.push(r)}))}))},t.prototype.refreshDeployments=function(){var t=this;this.cluster.getDeployments().then((function(e){t.storeDeployments.filter((function(t){return!t.is_deleted})).forEach((function(t){var r=e.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));!1!==(r=r.length>0&&r[0])?(t.update(r),e.splice(e.indexOf(r),1)):t.destroy()})),e=e.map((function(t){return new b(t)})),t.storeDeployments=t.storeDeployments.concat(e),e.forEach((function(e){t.__getNamespace(e.data.metadata.namespace).deployments.push(e)}))}))},t.prototype.attachStatefulsets=function(){var t=this;return this.cluster.getStatefulsets().then((function(e){e.forEach((function(e){var r=t.__getNamespace(e.metadata.namespace),n=new v(e);r.statefulsets.push(n),t.storeStatefulSets.push(n)}))}))},t.prototype.refreshStatefulsets=function(){var t=this;this.cluster.getStatefulsets().then((function(e){t.storeStatefulSets.filter((function(t){return!t.is_deleted})).forEach((function(t){var r=e.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));!1!==(r=r.length>0&&r[0])?(t.update(r),e.splice(e.indexOf(r),1)):t.destroy()})),e=e.map((function(t){return new v(t)})),t.storeStatefulSets=t.storeStatefulSets.concat(e),e.forEach((function(e){t.__getNamespace(e.data.metadata.namespace).statefulsets.push(e)}))}))},t.prototype.attachDaemonsets=function(){var t=this;return this.cluster.getDaemonsets().then((function(e){e.forEach((function(e){var r=t.__getNamespace(e.metadata.namespace),n=new _(e);r.daemonsets.push(n),t.storeDaemonSets.push(n)}))}))},t.prototype.refreshDaemonsets=function(){var t=this;this.cluster.getDaemonsets().then((function(e){t.storeDaemonSets.filter((function(t){return!t.is_deleted})).forEach((function(t){var r=e.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));!1!==(r=r.length>0&&r[0])?(t.update(r),e.splice(e.indexOf(r),1)):t.destroy()})),e=e.map((function(t){return new _(t)})),t.storeDaemonSets=t.storeDaemonSets.concat(e),e.forEach((function(e){t.__getNamespace(e.data.metadata.namespace).daemonsets.push(e)}))}))},t.prototype.attachJobs=function(){var t=this;this.namespaceMap.forEach((function(e){var r=t.storeJobs.filter((function(t){return!t.data.metadata.ownerReferences&&t.data.metadata.namespace===e.name}));t.storeCronJobs.filter((function(t){return t.data.metadata.namespace===e})).forEach((function(e){var n=e.data.metadata.uid;t.storeJobs.forEach((function(t){t.data.metadata.ownerReferences&&(t.data.metadata.ownerReferences.filter((function(t){return"CronJob"===t.kind&&t.uid===n}))[0]||r.push(t))}))})),e.jobs=r}))},t.prototype.attachCronJobs=function(){var t=this;this.namespaceMap.forEach((function(e){e.cronJobs=t.storeCronJobs.filter((function(t){return t.data.metadata.namespace===e.name})),e.cronJobs.forEach((function(e){var r=e.data.metadata.uid,n=[];t.storeJobs.forEach((function(t){t.data.metadata.ownerReferences&&t.data.metadata.ownerReferences.filter((function(t){return"CronJob"===t.kind&&t.uid===r}))[0]&&n.push(t)})),e.jobs=n}))}))},t.prototype.attachPodsToMap=function(){var t=this;this.namespaceMap.forEach((function(e){e.deployments.forEach((function(r){r.pods=t.__findPodsBySelector(r.data.spec.selector.matchLabels,e.name),r.services=t.__findServices(r)})),e.statefulsets.forEach((function(r){r.pods=t.__findPodsBySelector(r.data.spec.selector.matchLabels,e.name),r.services=t.__findServices(r)})),e.daemonsets.forEach((function(r){r.pods=t.__findPodsBySelector(r.data.spec.selector.matchLabels,e.name),r.services=t.__findServices(r)})),e.jobs.forEach((function(r){r.pods=t.__findPodsBySelector(r.data.metadata.labels,e.name)})),e.cronJobs.forEach((function(r){r.jobs.map((function(r){r.pods=t.__findPodsBySelector(r.data.metadata.labels,e.name)}))})),e.other[0].pods=t.storePods.filter((function(t){return!t.used&&t.data.metadata.namespace===e.name}))}))},t.prototype.updateJobs=function(){var t=this,e=[];e.push(this.refreshJobs()),this.$q.all(e).then((function(){t.attachJobs(),t.attachCronJobs()}))},t.prototype.__findPodsBySelector=function(t,e,r){return void 0===r&&(r=this.storePods),r.filter((function(t){return t.data.metadata.namespace===e})).filter((function(e){var r=e.data.metadata.labels;if(void 0===r)return!1;for(var n in t){if(!r.hasOwnProperty(n))return!1;if(r[n]!==t[n])return!1}return e.used=!0,!0}))},t.prototype.__findServices=function(t){var e=this;return this.storeServices.filter((function(r){if(!r.data.spec||!r.data.spec.selector)return!1;var n=r.data.spec.selector;return e.__findPodsBySelector(n,r.data.metadata.namespace,t.pods).length>0}))},t.prototype.__prepareDS=function(){var t=this;return this.datasourceSrv.get(this.location.search().clusterName).then((function(e){return t.cluster=e,t.__setRefreshRate(t.cluster.refreshRate),t.getPrometheusDS(t.cluster.prometheus).then((function(){t.pageReady=!0}))}))},t.prototype.getPrometheusDS=function(t){var e=this;return this.datasourceSrv.get(t).then((function(t){e.prometheusDS=new l(t)}))},t.prototype.getPods=function(t){var e=this;return void 0===t&&(t=!1),this.cluster.getPods().then((function(r){r instanceof Array?(e.podsError=!1,t&&(r=r.filter((function(t){return void 0!==t.status.hostIP}))),e.storePods=r.map((function(t){return new p(t)}))):r instanceof Error&&(e.podsError=r),e.timeout((function(){e.refreshPods(t)}),e.refreshRate)}))},t.prototype.refreshPods=function(t){var e=this;void 0===t&&(t=!1),this.cluster.getPods().then((function(r){r instanceof Array?(e.podsError=!1,t&&(r=r.filter((function(t){return void 0!==t.status.hostIP}))),e.storePods.filter((function(t){return!t.is_deleted})).forEach((function(t){var e=r.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));!1!==(e=e.length>0&&e[0])?(t.update(e),r.splice(r.indexOf(e),1)):t.destroy()})),r=r.map((function(t){return new p(t)})),e.storePods=e.storePods.concat(r),e.updatePods(r)):r instanceof Error&&(e.podsError=r)})),this.timeout((function(){e.refreshPods(t)}),this.refreshRate)},t.prototype.getClusterComponents=function(){var t=this;this.cluster.getComponents().then((function(e){e instanceof Array?(t.componentsError=!1,t.storeComponents=e.map((function(t){return new f(t)}))):e instanceof Error&&(t.componentsError=e),t.timeout((function(){t.refreshClusterComponents()}),t.refreshRate)}))},t.prototype.refreshClusterComponents=function(){var t=this;this.cluster.getComponents().then((function(e){e instanceof Array?(t.componentsError=!1,t.storeComponents=e.map((function(t){return new f(t)}))):e instanceof Error&&(t.componentsError=e),t.timeout((function(){t.refreshClusterComponents()}),t.refreshRate)}))},t.prototype.getAllServices=function(){var t=this;return this.cluster.getServices().then((function(e){t.storeServices=e.map((function(t){return new h(t)}))}))},t.prototype.getClusterJobs=function(){var t=this;return this.cluster.getJobs().then((function(e){t.storeJobs=e.map((function(t){return new m(t)}))}))},t.prototype.getClusterCronJobs=function(){var t=this;return this.cluster.getCronJobs().then((function(e){t.storeCronJobs=e.map((function(t){return new y(t)}))}))},t.prototype.refreshJobs=function(){var t=this;return this.cluster.getJobs().then((function(e){t.storeJobs.filter((function(t){return!t.is_deleted})).forEach((function(t){var r=e.filter((function(e){return e.metadata.uid===t.data.metadata.uid}));!1!==(r=r.length>0&&r[0])?(t.update(r),e.splice(e.indexOf(r),1)):t.destroy()})),e=e.map((function(t){return new m(t)})),t.storeJobs=t.storeJobs.concat(e)}))},t.prototype.__getNamespace=function(t){return this.namespaceMap.filter((function(e){return e.name===t}))[0]},t.prototype.__setRefreshRate=function(t){this.refreshRate=void 0===t?6e4:1e3*t},t.prototype.__getPodsLength=function(t){return void 0===t&&(t=[]),t.filter((function(t){return!t.is_deleted})).length},t.prototype.getWarningPods=function(){var t=this,e=this.storePods.filter((function(e){return t.podIsWarning(e)}));return e.length>0&&e.filter((function(t){return"Undefined error"===t.message})).length>0&&this.storePods.forEach((function(e,r){if(t.podIsWarning(e)&&"Undefined error"===e.message&&t.storeEvents){var n=t.storeEvents.find((function(t){return t.involvedObject.name===e.name}));void 0!==n&&(t.storePods[r].message=n.message)}})),this.sortByStatus(e)},t.prototype.sortByStatus=function(t,e){void 0===e&&(e=[u.d,u.k,u.g,u.f,u.h]);var r=[];return e.forEach((function(e){r.push.apply(r,Object(o.d)(t.filter((function(t){return t.status===e}))))})),r},t.prototype.getWarningNodes=function(){return this.nodesMap.filter((function(t){return t.status===u.d}))},t.prototype.goTo=function(t){var e=null;t&&(e=document.getElementsByClassName(t)[0]),e&&e.scrollIntoView({block:"center",behavior:"smooth"})},t.prototype.getAlertsNodesByCPU=function(t){return void 0===t&&(t="cpuStatus"),this.nodesMap.filter((function(e){return e[t]===u.k||e[t]===u.d}))},t.prototype.getAlertsNodesByMemory=function(t){return void 0===t&&(t="memoryStatus"),this.nodesMap.filter((function(e){return e[t]===u.k||e[t]===u.d}))},t.prototype.getAlertsNodesByPods=function(t){return void 0===t&&(t="podsStatus"),this.nodesMap.filter((function(e){return e[t]===u.k||e[t]===u.d}))},t.prototype.getAlertsComponents=function(){return this.storeComponents.filter((function(t){return t.status===u.d}))},t.prototype.getEvents=function(){var t=this;this.cluster.getEvents().then((function(e){t.storeEvents=e,t.timeout((function(){t.getEvents()}),t.refreshRate)}))},t.prototype.podIsWarning=function(t){return!t.is_deleted&&(t.status===u.k||t.status===u.d||t.status===u.h||!this.validResources(t))},t.prototype.validResources=function(t){return t.data.spec.containers.every((function(e){var r=[],n=[];return"kube-system"!==t.data.metadata.namespace&&t.status!==u.f&&(e.resources.requests&&e.resources.requests.cpu||r.push("CPU request"),e.resources.limits&&e.resources.limits.cpu||r.push("CPU limit"),e.resources.requests&&e.resources.requests.memory||n.push("Memory request"),e.resources.limits&&e.resources.limits.memory||n.push("Memory limit")),!(r.length>0||n.length>0)||(t.message='Container "'+e.name+'":\n                 '+(r.length&&"Specify "+r.join(" and ")+";")+"\n                 "+(n.length&&"Specify "+n.join(" and ")+";"),!1)}))},t.prototype.toggleMenu=function(){this.showMenu=!this.showMenu},t}(),N=function(t){function e(e,r,n,o,s,a,i,u,c){var p=t.call(this,e,o,s,a,i,u,n,c)||this;p.$q=n,p.backendSrv=o,p.datasourceSrv=s,p.contextSrv=a,p.$location=i,p.$timeout=u,p.$window=c,p.storageOpenKey="application-overview-open",p.storageShowColumnKey="application-overview-show-column",p.showScrollButton=!1,p.pageReady=!1,p.version=C(c),p.__prepareDS().then((function(){p.getEvents(),p.getClusters(),p.getClusterComponents(),p.getNamespaceMap()})),p.columnNames=[{colName:"Deployments",nsKey:"deployments"},{colName:"Statefulsets",nsKey:"statefulsets"},{colName:"Daemonsets",nsKey:"daemonsets"},{colName:"Other pods",nsKey:"other"},{colName:"Cron Jobs",nsKey:"cronJobs"},{colName:"Jobs",nsKey:"jobs"}],p.hideAllWarningPods=!0;var d=localStorage.getItem(p.storageOpenKey);p.open=d?JSON.parse(d):{};p.showColumn={cronJobs:{},jobs:{},other:{}},void 0===p.showColumn.other&&(p.showColumn.other={});var l=document.querySelector(".scroll-canvas");return l.addEventListener("scroll",(function(){p.showScrollButton=l.scrollTop>64,e.$apply()})),p}return Object(o.b)(e,t),e.prototype.getClusters=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e,r;return Object(o.c)(this,(function(n){switch(n.label){case 0:return[4,this.datasourceSrv.getAll()];case 1:return t=n.sent(),e=u.i,Array.isArray(t)?this.clusters=t.filter((function(t){return t.type===e})):(r=[],Object.keys(t).forEach((function(n){t[n].type===e&&r.push(t[n])})),this.clusters=r),[2]}}))}))},e.prototype.__showAll=function(){this.toggleNamespace(!0)},e.prototype.__hideAll=function(){this.toggleNamespace(!1)},e.prototype.namespaceClick=function(t,e){t.ctrlKey||t.metaKey?(e.open&&t.preventDefault(),this.toggleNamespace(e)):e.toggle()},e.prototype.toggleNamespace=function(t){s.delete("namespaceStore");var e=[];this.namespaceMap.map((function(r){r.open=!0===t||!1===t?t:t.name===r.name,e.push({name:r.name,open:r.open})})),s.setObject("namespaceStore",e)},e.prototype.updatePods=function(t){this.refreshNamespaceMap()},e.prototype.toggleAllWarningPods=function(){this.hideAllWarningPods=!this.hideAllWarningPods},e.prototype.namespaceFilterIsDeleted=function(t){return t.filter((function(t){return!1===t.is_deleted||void 0===t.is_deleted}))},e.prototype.namespaceCount=function(){return this.namespaceMap?this.namespaceMap.length:0},e.prototype.namespaceActiveCount=function(){return this.namespaceMap?this.namespaceMap.filter((function(t){return t.open})).length:0},e.prototype.toggleTab=function(t){void 0===this.open[t]?this.open[t]=!1:this.open[t]=!this.open[t],localStorage.setItem(this.storageOpenKey,JSON.stringify(this.open))},e.prototype.toggleColumn=function(t,e){void 0===this.showColumn[t][e]?this.showColumn[t][e]=!0:this.showColumn[t][e]=!this.showColumn[t][e]},e.prototype.showCheck=function(t,e){return"jobs"!==t&&"cronJobs"!==t&&"other"!==t||void 0!==this.showColumn[t][e]&&!1!==this.showColumn[t][e]},e.$inject=["$scope","$injector","$q","backendSrv","datasourceSrv","contextSrv","$location","$timeout","$window"],e.templateUrl="components/applications-overview/applications-overview.html",e}(R),D=function(){function t(t,e,r,n,o,s,a){var i=this;this.backendSrv=r,this.datasourceSrv=n,this.contextSrv=o,this.utilSrv=s,this.$window=a,this.showScrollButton=!1,this.isReady=!1,this.$scope=t,this.version=C(a),document.title="DevOpsProdigy KubeGraf";try{this.getClusters().then((function(){i.isReady=!0,i.$scope.$apply()}))}catch(t){}try{this.isAdmin=this.contextSrv.hasRole("Admin")}catch(t){this.isAdmin=!1}var u=document.querySelector(".scroll-canvas");u.addEventListener("scroll",(function(){i.showScrollButton=u.scrollTop>64,t.$apply()}))}return t.prototype.getClusters=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e,r;return Object(o.c)(this,(function(n){switch(n.label){case 0:return[4,this.datasourceSrv.getAll()];case 1:return t=n.sent(),e=u.i,Array.isArray(t)?this.clusters=t.filter((function(t){return t.type===e})):(r=[],Object.keys(t).forEach((function(n){t[n].type===e&&r.push(t[n])})),this.clusters=r),[2]}}))}))},t.prototype.deleteCluster=function(t){var e=this;i.a.emit("confirm-modal",{title:"Delete",text:"Are you sure you want to delete this cluster?",yesText:"Delete",icon:"fa-trash",onConfirm:function(){e.confirmDelete(t.id)}})},t.prototype.confirmDelete=function(t){var e=this;this.backendSrv.delete("/api/datasources/"+t).then((function(){e.clusters=e.clusters.filter((function(e){return e.id!==t})),e.$scope.$apply()}))},t.$inject=["$scope","$injector","backendSrv","datasourceSrv","contextSrv","utilSrv","$window"],t.templateUrl="components/clusters-list/clusters-list.html",t}(),k=function(){function t(t,e,r,n,o,s,a,i){var u=this;this.backendSrv=r,this.datasourceSrv=n,this.alertSrv=o,this.$q=s,this.$location=a,this.$window=i,this.retry=3,this.pageReady=!1,this.$scope=t,this.busy=!1,this.version=C(i),this.getCluster().finally((function(){u.pageReady=!0,u.$scope.$apply()}))}return t.prototype.getCluster=function(){return Object(o.a)(this,void 0,Promise,(function(){return Object(o.c)(this,(function(t){switch(t.label){case 0:return"clusterId"in this.$location.search()?[4,this.getDatasource(this.$location.search().clusterId)]:[3,2];case 1:return t.sent(),document.title="DevOpsProdigy KubeGraf | Edit cluster",[3,3];case 2:this.cluster={type:u.i,access:"proxy",jsonData:{refresh_pods_rate:"60",access_via_token:!1,prom_name:""}},document.title="DevOpsProdigy KubeGraf | New cluster",t.label=3;case 3:return[4,this.getPrometheusList()];case 4:return t.sent(),[2]}}))}))},t.prototype.getPrometheusList=function(){var t=this;return this.backendSrv.get("/api/datasources").then((function(e){t.prometheusList=e.filter((function(t){return t.type===u.j}));var r=t.prometheusList.filter((function(t){return t.isDefault}));r.length>0&&""===t.cluster.jsonData.prom_name&&(t.cluster.jsonData.prom_name=r[0].name)}))},t.prototype.saveCluster=function(){var t=this;if(!this.busy)return this.busy=!0,this.cluster.jsonData.cluster_url=this.cluster.url,this.saveDatasource().then((function(e){e&&e.datasource&&(t.cluster=e.datasource,t.testCluster())})).finally((function(){t.busy=!1}))},t.prototype.check=function(){return!!this.pageReady&&this.$scope.clusterForm.$valid},t.prototype.saveDatasource=function(){return this.cluster.id?this.updateDatasource():this.createDatasource()},t.prototype.createDatasource=function(){var t=this;return this.backendSrv.post("/api/datasources",this.cluster).then((function(e){return t.$q.resolve(e)}),(function(e){return t.$q.reject(e)}))},t.prototype.updateDatasource=function(){var t=this;return this.backendSrv.put("/api/datasources/"+this.cluster.id,this.cluster).then((function(e){return t.$q.resolve(e)}),(function(e){return t.$q.reject(e)}))},t.prototype.getDatasource=function(t){var e=this;return this.backendSrv.get("/api/datasources/"+t).then((function(t){t.jsonData.prom_name||(t.jsonData.prom_name=""),t.jsonData.refresh_pods_rate||(t.jsonData.refresh_pods_rate="60"),e.cluster=t}))},t.prototype.testCluster=function(){var t="/api/datasources/proxy/"+this.cluster.id;this.cluster.jsonData.access_via_token&&(t+="/__proxy"),t+="/api/v1/namespaces",this.backendSrv.datasourceRequest({url:t,method:"GET",headers:{"Content-Type":"application/json"}}).then((function(t){t&&200===t.status?setTimeout((function(){window.history.back()}),800):i.a.emit("alert-error",["Unhandled error"])}),(function(t){t&&t.status&&t.statusText?i.a.emit("alert-error",[t.status+" "+t.statusText]):i.a.emit("alert-error",["Unhandled error"])}))},t.templateUrl="components/cluster-config/cluster-config.html",t.$inject=["$scope","$injector","backendSrv","datasourceSrv","alertSrv","$q","$location","$window"],t}(),L=function(){function t(t){var e=t.search().clusterName;e&&(window.location.href="plugins/devopsprodigy-kubegraf-app/page/applications-overview?clusterName="+e)}return t.$inject=["$location"],t}(),x=function(t){function e(e,r,n,o,s,a,i,u,c){var p=t.call(this,e,o,s,a,i,u,n,c)||this;p.$q=n,p.backendSrv=o,p.datasourceSrv=s,p.contextSrv=a,p.$location=i,p.$timeout=u,p.$window=c,p.storageOpenKey="nodes-overview-open",p.serverInfo=null,p.hideAllWarningPods=!0,p.showScrollButton=!1,p.pageReady=!1,p.version=C(c),p.__prepareDS().then((function(){p.getEvents(),p.getClusters(),p.getNodeMap().then((function(){p.nodesMap.length>0&&null===p.serverInfo&&p.getServerInfo(),p.pageReady=!0})).then((function(){p.getResourcesMetrics().then((function(){}))}))}));var d=localStorage.getItem(p.storageOpenKey);p.open=d?JSON.parse(d):{};var l=document.querySelector(".scroll-canvas");return l.addEventListener("scroll",(function(){p.showScrollButton=l.scrollTop>64,e.$apply()})),p}return Object(o.b)(e,t),e.prototype.getClusters=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e,r;return Object(o.c)(this,(function(n){switch(n.label){case 0:return[4,this.datasourceSrv.getAll()];case 1:return t=n.sent(),e=u.i,Array.isArray(t)?this.clusters=t.filter((function(t){return t.type===e})):(r=[],Object.keys(t).forEach((function(n){t[n].type===e&&r.push(t[n])})),this.clusters=r),[2]}}))}))},e.prototype.getServerInfo=function(){var t=this;this.serverInfo={},this.__getServersInfo(this.nodesMap).then((function(e){t.serverInfo=e}))},e.prototype.showAllPodsNS=function(t){t.limit=!1},e.prototype.toggleNsList=function(t){t.hideNs=!t.hideNs},e.prototype.updatePods=function(t){this.insertPodsToNodesMap(t)},e.prototype.summary=function(t,e){var r=0;switch(t.pods&&(r=t.pods.reduce((function(t,r){return r.sourceMetrics[e]?t+r.sourceMetrics[e]:t}),0)),e){case"cpuUsed":return O(r.toFixed(3));case"cpuRequested":case"cpuLimit":return O(w(r));case"memoryUsed":case"memoryRequested":case"memoryLimit":return M(r);default:return"N-A"}},e.prototype.nodeClick=function(t,e){t.ctrlKey?(e.open&&t.preventDefault(),this.toggleNodes(e)):e.toggle()},e.prototype.__showAll=function(){this.toggleNodes(!0)},e.prototype.__hideAll=function(){this.toggleNodes(!1)},e.prototype.toggleNodes=function(t){s.delete("nodeStore");var e=[];this.nodesMap.map((function(r){r.open=!0===t||!1===t?t:t.name===r.name,e.push({name:r.name,open:r.open})})),s.setObject("nodeStore",e)},e.prototype.podsFilterIsDeleted=function(t){return t.filter((function(t){return!1===t.is_deleted}))},e.prototype.sort=function(t,e,r){this.nodesMap[r]&&this.nodesMap[r].namespaces[e]&&(0===this.nodesMap[r].namespaces[e].sort.indexOf(t)?this.nodesMap[r].namespaces[e].sort="-"+t:this.nodesMap[r].namespaces[e].sort=t)},e.prototype.icon=function(t,e,r){if(this.nodesMap[r]&&this.nodesMap[r].namespaces[e]){if(0===this.nodesMap[r].namespaces[e].sort.indexOf(t))return'<i class="fa fa-long-arrow-down"></i>';if(0===this.nodesMap[r].namespaces[e].sort.indexOf("-"+t))return'<i class="fa fa-long-arrow-up"></i>'}return'<i class="fa fa-long-arrow-up grey"></i>'},e.prototype.toggleAllWarningPods=function(){this.hideAllWarningPods=!this.hideAllWarningPods},e.prototype.nodeCount=function(){return this.nodesMap?this.nodesMap.length:0},e.prototype.nodeActiveCount=function(){return this.nodesMap?this.nodesMap.filter((function(t){return t.open})).length:0},e.prototype.toggleTab=function(t){void 0===this.open[t]?this.open[t]=!1:this.open[t]=!this.open[t],localStorage.setItem(this.storageOpenKey,JSON.stringify(this.open))},e.templateUrl="components/nodes-overview/nodes-overview.html",e.$inject=["$scope","$injector","$q","backendSrv","datasourceSrv","contextSrv","$location","$timeout","$window"],e}(R),$=function(t){function e(e,r,n,o,s,a,i,u,c){var p=t.call(this,e,o,s,a,i,u,n,c)||this;p.$q=n,p.backendSrv=o,p.datasourceSrv=s,p.contextSrv=a,p.$location=i,p.$timeout=u,p.$window=c,p.showScrollButton=!1,p.pageReady=!1,p.version=C(c),p.__prepareDS().then((function(){var t=[];t.push(p.getEvents()),t.push(p.getPods()),t.push(p.getClusterComponents()),t.push(p.getClusters()),t.push(p.getNodeMap(!0).then((function(){p.getResourcesMetrics().then((function(){p.nodesMapReady=!0}))}))),p.$q.all(t).then((function(){p.pageReady=!0}))}));var d=document.querySelector(".scroll-canvas");return d.addEventListener("scroll",(function(){p.showScrollButton=d.scrollTop>64,e.$apply()})),p}return Object(o.b)(e,t),e.prototype.getAlertsNodesByCPU2=function(t){void 0===t&&(t="cpuStatus")},e.prototype.getClusters=function(){return Object(o.a)(this,void 0,void 0,(function(){var t,e,r;return Object(o.c)(this,(function(n){switch(n.label){case 0:return[4,this.datasourceSrv.getAll()];case 1:return t=n.sent(),e=u.i,Array.isArray(t)?this.clusters=t.filter((function(t){return t.type===e})):(r=[],Object.keys(t).forEach((function(n){t[n].type===e&&r.push(t[n])})),this.clusters=r),[2]}}))}))},e.prototype.getAlertsNodesByResources=function(){var t=this;return this.nodesMap.filter(this.resourceProblem).map((function(e){return e.cpuStatus===u.d||e.cpuStatusRequested===u.d||e.memoryStatus===u.d||e.memoryStatusRequested===u.d||e.podsStatus===u.d?(e.statusColor=u.b,e.statusForSort=u.d):(e.statusColor=u.c,e.statusForSort=u.k),e.statusMessage=t.nodeMessages(e).join(";<br/>"),e})).sort((function(t,e){return e.statusForSort-t.statusForSort}))},e.prototype.clusterProblem=function(){var t=[0===this.getWarningNodes().length,0===this.getAlertsNodesByCPU().length,0===this.getAlertsNodesByMemory().length,0===this.getAlertsNodesByPods().length,0===this.getAlertsNodesByCPU("cpuStatusRequested").length,0===this.getAlertsNodesByMemory("memoryStatusRequested").length,0===this.getWarningPods().length,0===this.getAlertsComponents.length];return this.nodesError||this.componentsError||this.podsError||t.some((function(t){return!0!==t}))},e.prototype.resourceProblem=function(t){return t.cpuStatus===u.k||t.cpuStatus===u.d||t.cpuStatusRequested===u.d||t.cpuStatusRequested===u.k||t.memoryStatus===u.d||t.memoryStatus===u.k||t.memoryStatusRequested===u.d||t.memoryStatusRequested===u.k||t.podsStatus===u.k||t.podsStatus===u.d},e.prototype.nodeMessages=function(t){var e=[];return t.cpuStatus!==u.d&&t.cpuStatus!==u.k||e.push("CPU used: "+t.cpuPercentUsed),t.cpuStatusRequested!==u.d&&t.cpuStatusRequested!==u.k||e.push("CPU requested: "+t.cpuPercentRequested),t.memoryStatus!==u.d&&t.memoryStatus!==u.k||e.push("Memory used: "+t.memoryPercentUsed),t.memoryStatusRequested!==u.d&&t.memoryStatusRequested!==u.k||e.push("Memory requested: "+t.memoryPercentUsed),t.podsStatus!==u.d&&t.podsStatus!==u.k||e.push("Pods count used: "+t.podsPercentUsed),e},e.templateUrl="components/cluster-alerts/cluster-alerts.html",e.$inject=["$scope","$injector","$q","backendSrv","datasourceSrv","contextSrv","$location","$timeout","$window"],e}(R),I=function(){function t(t,e,r){this.$q=r,this.enabled=!1,this.appEditCtrl.setPostUpdateHook()}return t.prototype.postUpdate=function(){var t=this;return this.appModel.enabled?this.appEditCtrl.importDashboards().then((function(){return t.enabled=!0,{url:"plugins/devopsprodigy-kubegraf-app/page/clusters",message:"DevOpsProdigy KubeGraf enabled!"}})):this.$q.resolve()},t.templateUrl="config/config.html",t.$inject=["$scope","$injector","$q"],t}();r.d(e,"ApplicationsOverview",(function(){return N})),r.d(e,"ClusterAlerts",(function(){return $})),r.d(e,"ClusterConfig",(function(){return k})),r.d(e,"ClusterOverview",(function(){return L})),r.d(e,"ClustersList",(function(){return D})),r.d(e,"NodesOverview",(function(){return x})),r.d(e,"ConfigCtrl",(function(){return I})),Object(n.loadPluginCss)({dark:"plugins/devopsprodigy-kubegraf-app/styles/dark.css",light:"plugins/devopsprodigy-kubegraf-app/styles/light.css"})}])}));
//# sourceMappingURL=module.js.map